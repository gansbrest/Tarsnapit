== Tarsnapit ==

Super simple php scirpt which allows you to make periodic backups of specified dirs as well as mysql databases (you should be able to modify it pretty easily to support other databases). 

You can configure it to keep backups for specified number of days, plus there is an option to  keep at least specified number of days of backups (default 15) in case something happens to the backup process and you didn't notice it right away.

There is no separate configuration file at the moment - so all config is done in the script.

The script should be perfect for daily backups of small to medium applications. 

The main focus of tarsnapit script is daily backups.

=== Security ===

Make sure to set correct permissions on the tarsnapit script, especially if you are going to backup your databaseses, so you not reveal your DB passwords.

=== Basic usage ===

===== 1) Config sample =====

Note: Make sure to adjust your php location at the top of the script ( #!/usr/bin/php ) or provide path to php in the crontab.

define('TARSNAP_BIN', '/usr/local/bin/tarsnap');
define('DB_BACKUP_DIR', '/usr/local/backup/');
define('EXCLUSIONS_FILE', '/usr/local/backup/exclusions.txt');
define('DELETE_OLD_ARCH_AFTER', '30days');
define('KEEP_AT_LEAST', '15days');

# Perform db backups
$dbsList = array(
  'db1' => array(
    'username' => 'user1',
    'pass' => 'pass1',
  ),
  'db2' => array(
    'username' => 'user2',
    'pass' => 'pass2',
  ),
);

# Files and folders to archive
$filesAndFoldersArr = array(
  'system' => array(
    '/etc',
    '/var/spool',
    '/usr/share/munin',
  ),
  'homedirs' => array(
    '/home/gansbrest',
    '/home/git',
  ),
  'db_dumps' => array(
    DB_BACKUP_DIR,
  ),
  'sites' => array(
    '/var/www/',
  ),
);

# Files and folders to exclude from backup 
$excludesArr = array(
  '/home/gansbrest/drush-backups',
  '/var/www/website1/files/website1/imagecache',
  '/var/www/website2/multisite_files/website2/imagecache',
);


===== 2) Set up crontab =====

31 22 * * * /path/to/tarsnapit/tarsnapit.php >> /var/log/crons/crons.txt 

you could add 2>&1 to write tarsnap stat to the log file instead of email notifications. 

===== 3) Test if tarsnapit actually produced anything =====

tarsnap --list-archives 

should produce something like this

2012-02-23-prod-db_dumps
2012-02-25-prod-db_dumps
2012-02-24-prod-homedirs
2012-02-25-prod-homedirs
2012-02-21-prod-db_dumps
2012-02-25-prod-sites
2012-02-20-prod-homedirs
.....


